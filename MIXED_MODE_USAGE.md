# 混合模式使用指南

## 概述

项目现在支持两种分析模式：

1. **浏览器网页版模式（默认）**：使用浏览器自动化在 Gemini 网页版内部分析，无需 API key
2. **API 模式**：使用 Gemini API 进行分析，需要配置 `GEMINI_API_KEY`

## 使用方法

### 浏览器网页版模式（默认，推荐）

这是默认模式，不需要配置 API key，直接在浏览器中使用 Gemini 网页版进行分析。

```bash
# 立即执行一次（浏览器模式）
python main.py --once

# 定时任务模式（浏览器模式）
python main.py
```

**特点：**
- ✅ 无需 API key
- ✅ 免费使用 Gemini 网页版
- ✅ 可以在浏览器中查看完整的分析过程
- ✅ 支持图片上传和分析
- ⚠️ 需要手动确认某些操作（如果自动操作失败）

### API 模式

使用 Gemini API 进行分析，需要配置 `GEMINI_API_KEY`。

```bash
# 立即执行一次（API 模式）
python main.py --once --api

# 定时任务模式（API 模式）
python main.py --api
```

**特点：**
- ✅ 完全自动化，无需人工干预
- ✅ 分析结果直接返回，便于后续处理
- ⚠️ 需要配置有效的 API key
- ⚠️ 可能有 API 调用费用

## 命令行参数

| 参数 | 说明 |
|------|------|
| `--once` | 立即执行一次（测试模式） |
| `--api` | 使用 API 模式进行分析 |
| `--help` | 显示帮助信息 |

## 使用示例

### 示例 1：使用浏览器模式立即执行一次

```bash
python main.py --once
```

输出：
```
[步骤2] 开始Gemini分析...
  [模式] 使用浏览器网页版模式进行分析（默认）
[INFO] 使用 Gemini 网页版进行分析（浏览器模式）
  正在打开 Gemini 网页版...
  正在上传图片...
  ✓ 图片上传成功
  正在输入分析提示词...
  ✓ 已发送分析请求
  等待分析结果...
  ✓ 成功获取分析结果
```

### 示例 2：使用 API 模式立即执行一次

```bash
python main.py --once --api
```

输出：
```
[步骤2] 开始Gemini分析...
  [模式] 使用 API 模式进行分析
[OK] 成功初始化模型: models/gemini-2.0-flash
  正在分析页面内容...
[OK] 分析完成
```

### 示例 3：查看帮助信息

```bash
python main.py --help
```

## 浏览器模式详细说明

### 工作流程

1. **打开 Gemini 网页版**：程序会自动打开 `https://gemini.google.com`
2. **上传图片**：自动上传需要分析的截图
3. **输入提示词**：自动输入分析提示词
4. **获取结果**：等待并获取分析结果

### 手动操作提示

如果自动操作失败，程序会提示您手动操作：

1. **上传图片失败**：
   - 程序会提示您手动上传图片
   - 您有 15 秒时间手动上传
   - 上传后程序会自动继续

2. **获取结果失败**：
   - 程序会保持浏览器打开
   - 您可以在浏览器中查看完整的分析结果
   - 结果会显示在 Gemini 网页版中

### 注意事项

- 浏览器模式需要保持浏览器窗口打开
- 如果使用远程调试模式，浏览器不会自动关闭
- 如果使用直接打开模式，程序结束后浏览器可能会关闭
- 建议使用远程调试模式，这样可以保持浏览器打开并查看结果

## API 模式配置

如果使用 API 模式，需要在 `.env` 文件中配置：

```env
GEMINI_API_KEY=your_api_key_here
GEMINI_MODEL=gemini-2.0-flash
```

## 模式切换

程序支持自动降级：
- 如果指定使用 API 模式但未配置 API key，会自动切换到浏览器模式
- 如果 API 模式失败，也会自动切换到浏览器模式

## 推荐配置

**日常使用推荐：浏览器模式**
- 免费使用
- 无需配置 API key
- 可以在浏览器中查看完整过程

**自动化场景推荐：API 模式**
- 完全自动化
- 适合定时任务
- 结果直接返回，便于后续处理

